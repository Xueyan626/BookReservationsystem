# å›¾ç‰‡ä¸Šä¼ åŠŸèƒ½ä¿®å¤è¯´æ˜

## é—®é¢˜æè¿°

åœ¨æ·»åŠ æ–°ä¹¦æ—¶ï¼Œä¸Šä¼ çš„å›¾ç‰‡é“¾æ¥æ— æ³•æˆåŠŸä¼ å…¥æ•°æ®åº“çš„ `avatar` å­—æ®µã€‚

## å·²å®Œæˆçš„ä¿®å¤

### 1. åç«¯ä¿®æ”¹ âœ…

#### æ–‡ä»¶: `BookController.java`
- âœ… æ·»åŠ äº† `/api/books/cover` å›¾ç‰‡ä¸Šä¼ æ¥å£
- âœ… ç”Ÿæˆå”¯ä¸€æ–‡ä»¶åï¼ˆUUIDï¼‰
- âœ… è‡ªåŠ¨åˆ›å»º covers ç›®å½•
- âœ… ä¿å­˜åˆ° `src/main/webapp/resource/img/covers/` ç›®å½•
- âœ… è¿”å›æ ‡å‡†æ ¼å¼è·¯å¾„ï¼š`/img/covers/{filename}.{ext}`
- âœ… æ·»åŠ è¯¦ç»†æ—¥å¿—ç”¨äºè°ƒè¯•

#### æ–‡ä»¶: `application.properties`
- âœ… æ·»åŠ æ–‡ä»¶ä¸Šä¼ å¤§å°é™åˆ¶é…ç½®ï¼ˆæœ€å¤§ 10MBï¼‰

### 2. å‰ç«¯ä¿®æ”¹ âœ…

#### æ–‡ä»¶: `BookManagement.vue`
- âœ… æ”¹è¿›äº†ä¸Šä¼ é”™è¯¯å¤„ç†
- âœ… æ·»åŠ è¯¦ç»†çš„è°ƒè¯•æ—¥å¿—
- âœ… æ›´å¥½çš„é”™è¯¯ä¿¡æ¯æ˜¾ç¤º

#### æ–‡ä»¶: `api.js`
- âœ… ä¼˜åŒ–äº† `uploadCover` æ–¹æ³•

### 3. CORS é…ç½® âœ…

#### æ–‡ä»¶: `SecurityBeans.java`
- âœ… æ·»åŠ  `exposedHeaders` æ”¯æŒæ–‡ä»¶ä¸Šä¼ 

## æµ‹è¯•æ–¹æ³•

### æ­¥éª¤ 1: é‡æ–°ç¼–è¯‘åç«¯

```bash
cd library-reservation-system
mvn clean compile
mvn spring-boot:run
```

### æ­¥éª¤ 2: æ£€æŸ¥åç«¯æ—¥å¿—

å¯åŠ¨åç«¯åï¼Œå°è¯•ä¸Šä¼ å›¾ç‰‡ï¼Œè§‚å¯Ÿæ§åˆ¶å°è¾“å‡ºï¼š

```
ğŸ“¤ Received upload request - File: cave.jpg, Size: 12345
ğŸ“ Original filename: cave.jpg
ğŸ“ Generated filename: uuid-xxx-xxx.jpg
ğŸ“‚ Using webapp path: ...
ğŸ“‚ Upload directory: ...
ğŸ“ Directory created: true
ğŸ’¾ Saving file to: .../covers/uuid-xxx.jpg
âœ… Cover uploaded successfully: /img/covers/uuid-xxx.jpg
```

å¦‚æœçœ‹åˆ°é”™è¯¯ä¿¡æ¯ï¼š
```
âŒ Error: No file uploaded
âŒ Upload failed: ...
âŒ Unexpected error: ...
```

### æ­¥éª¤ 3: æµ‹è¯•ä¸Šä¼ 

1. åˆ·æ–°æµè§ˆå™¨é¡µé¢
2. ç‚¹å‡» "+New" æŒ‰é’®
3. å¡«å†™ä¹¦ç±ä¿¡æ¯
4. é€‰æ‹©å›¾ç‰‡æ–‡ä»¶
5. ç‚¹å‡» "Save"
6. æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·ï¼ˆF12ï¼‰
7. æŸ¥çœ‹ Console æ ‡ç­¾é¡µçš„è¾“å‡º

### æ­¥éª¤ 4: æ£€æŸ¥ç»“æœ

1. æŸ¥çœ‹åç«¯æ§åˆ¶å°çš„æ—¥å¿—
2. æ£€æŸ¥æ–‡ä»¶æ˜¯å¦ä¿å­˜åˆ° `src/main/webapp/resource/img/covers/` ç›®å½•
3. æŸ¥çœ‹æ•°æ®åº“ä¸­ `avatar` å­—æ®µæ˜¯å¦æœ‰å€¼
4. åˆ·æ–°é¡µé¢æŸ¥çœ‹å›¾ç‰‡æ˜¯å¦æ˜¾ç¤º

## å¸¸è§é—®é¢˜æ’æŸ¥

### é—®é¢˜ 1: "Upload failed"

å¯èƒ½åŸå› ï¼š
- åç«¯æ²¡æœ‰æ­£ç¡®å¯åŠ¨
- æ–‡ä»¶å¤§å°è¶…è¿‡é™åˆ¶
- ç½‘ç»œè¿æ¥é—®é¢˜

è§£å†³æ–¹æ³•ï¼š
1. æ£€æŸ¥åç«¯æ˜¯å¦è¿è¡Œåœ¨ http://localhost:8080
2. æ£€æŸ¥å›¾ç‰‡å¤§å°ï¼ˆå»ºè®® < 2MBï¼‰
3. æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°çš„è¯¦ç»†é”™è¯¯ä¿¡æ¯

### é—®é¢˜ 2: å›¾ç‰‡æ²¡æœ‰ä¿å­˜

å¯èƒ½åŸå› ï¼š
- ç›®å½•è·¯å¾„ä¸æ­£ç¡®
- æƒé™é—®é¢˜

è§£å†³æ–¹æ³•ï¼š
1. æ£€æŸ¥åç«¯æ—¥å¿—ä¸­çš„ "Upload directory" è·¯å¾„
2. æ‰‹åŠ¨åˆ›å»º `src/main/webapp/resource/img/covers/` ç›®å½•
3. ç¡®ä¿ç›®å½•æœ‰å†™å…¥æƒé™

### é—®é¢˜ 3: avatar å­—æ®µä¸º NULL

å¯èƒ½åŸå› ï¼š
- ä¸Šä¼ å¤±è´¥ä½†æ²¡æœ‰æ­£ç¡®æ•è·é”™è¯¯
- å‰ç«¯è¿”å›è·¯å¾„æ ¼å¼ä¸æ­£ç¡®

è§£å†³æ–¹æ³•ï¼š
1. æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°çš„ä¸Šä¼ æ—¥å¿—
2. ç¡®è®¤è¿”å›çš„ `filename` æ ¼å¼ä¸º `/img/covers/xxx.jpg`
3. æ£€æŸ¥æ•°æ®åº“ä¸­çš„å®é™…ä¿å­˜å€¼

## è°ƒè¯•æ—¥å¿—è¯´æ˜

### å‰ç«¯æ—¥å¿—
```javascript
ğŸ“¤ Starting upload for file: cave.jpg
ğŸ“¤ Using BooksAPI.uploadCover
âœ… Upload response: { filename: '/img/covers/xxx.jpg' }
```

### åç«¯æ—¥å¿—
```java
ğŸ“¤ Received upload request - File: cave.jpg, Size: 12345
ğŸ“ Original filename: cave.jpg
ğŸ“ Generated filename: uuid.jpg
ğŸ“‚ Upload directory: .../covers/
ğŸ’¾ Saving file to: .../uuid.jpg
âœ… Cover uploaded successfully: /img/covers/uuid.jpg
```

## é¢„æœŸç»“æœ

æ·»åŠ æ–°ä¹¦åï¼š
- âœ… å›¾ç‰‡ä¿å­˜åˆ° `src/main/webapp/resource/img/covers/` ç›®å½•
- âœ… æ•°æ®åº“ä¸­ `avatar` å­—æ®µæ ¼å¼ä¸º `/img/covers/{uuid}.jpg`
- âœ… ç•Œé¢ä¸Šæ˜¾ç¤ºä¸Šä¼ çš„å›¾ç‰‡
- âœ… å’Œç°æœ‰ä¹¦ç±çš„å›¾ç‰‡æ ¼å¼ä¸€è‡´

## æ‰‹åŠ¨æµ‹è¯•

å¦‚æœè‡ªåŠ¨ä¸Šä¼ ä»ç„¶å¤±è´¥ï¼Œå¯ä»¥æ‰‹åŠ¨å¤åˆ¶å›¾ç‰‡ï¼š

1. å°†å›¾ç‰‡å¤åˆ¶åˆ° `src/main/webapp/resource/img/covers/` ç›®å½•
2. æ‰‹åŠ¨è®¾ç½® avatar æ ¼å¼ä¸ºï¼š`/img/covers/ä½ çš„æ–‡ä»¶å.jpg`
3. åˆ·æ–°æ•°æ®åº“å’Œé¡µé¢

## è”ç³»æ”¯æŒ

å¦‚æœé—®é¢˜ä»ç„¶å­˜åœ¨ï¼Œè¯·æä¾›ï¼š
1. æµè§ˆå™¨æ§åˆ¶å°çš„å®Œæ•´é”™è¯¯ä¿¡æ¯
2. åç«¯æ§åˆ¶å°çš„å®Œæ•´æ—¥å¿—
3. ä¸Šä¼ çš„æ–‡ä»¶åå’Œå¤§å°
4. æ“ä½œç³»ç»Ÿå’Œæµè§ˆå™¨ç‰ˆæœ¬

